{"version":3,"file":"index.esm.js","sources":["../src/ReactMultiCrop/ReactMultiCrop.tsx"],"sourcesContent":["import React, { Component } from 'react';\nimport { fabric } from 'fabric';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\n\nexport interface IRecordProps {\n  image?: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  clippings: Array<any>;\n}\n\nexport interface IOutputData extends ICoord {\n  crop?: string;\n  deletedAt?: string;\n  dataUrl?: string | null;\n  canvasElement?: HTMLCanvasElement | null;\n}\n\nexport interface IInputProps {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  value: string | any;\n  name: string;\n  onChange(value: Array<IOutputData>): void;\n}\n\nexport interface IReactMultiCropProps {\n  id?: string;\n  width?: number;\n  height?: number;\n  source?: string;\n  input?: IInputProps;\n  record?: IRecordProps;\n  image?: string;\n  cropBackgroundColor?: string;\n  cropBackgroundOpacity?: number;\n  cropOutlineColor?: string;\n  cropOutlineWidth?: number;\n  showLabel?: boolean;\n  showButton?: boolean;\n  includeDataUrl?: boolean;\n  includeHtmlCanvas?: boolean;\n  readonly?: boolean;\n  onHover?(value: IOutputData | null): void;\n  onSelect?(value: IOutputData | null): void;\n}\n\nexport interface IReactMultiCropStates {\n  canvas: fabric.Canvas | null;\n  initial: boolean;\n}\n\nexport interface IRectCoord {\n  x1: number;\n  x2: number;\n  y1: number;\n  y2: number;\n}\n\nexport interface ICoord {\n  id: string | null;\n  rect: IRectCoord | string;\n}\n\nexport interface IAttribute {\n  left: number;\n  top: number;\n  height: number;\n  width: number;\n}\n\nexport interface ICustomFabricRect extends fabric.IRectOptions {\n  id: string | null;\n}\n\nexport class CustomFabricRect extends fabric.Rect {\n  public id: string | null = null;\n  constructor(options?: ICustomFabricRect) {\n    super(options);\n    if (options) {\n      this.id = options.id;\n    }\n  }\n}\n\nclass ReactMultiCrop extends Component<IReactMultiCropProps, IReactMultiCropStates> {\n  public static defaultProps = {\n    id: 'canvas',\n    width: 800,\n    height: 800,\n    input: null,\n    source: 'react-crop-form',\n    record: {\n      image: null,\n      clippings: [],\n    },\n    image: null,\n    cropBackgroundColor: 'yellow',\n    cropBackgroundOpacity: 0.5,\n    cropOutlineColor: 'yellow',\n    cropOutlineWidth: 5,\n    readonly: false,\n    showLabel: false,\n    showButton: false,\n    includeDataUrl: false,\n    includeHtmlCanvas: false,\n  };\n\n  private color: string;\n  private opacity: number;\n  private strokeColor: string;\n  private strokeWidth: number;\n  private strokeDashArray: Array<number>;\n  private REGEXP_ORIGINS = /^(\\w+:)\\/\\/([^:/?#]*):?(\\d*)/i;\n\n  constructor(props: IReactMultiCropProps) {\n    super(props);\n\n    this.state = {\n      canvas: null,\n      initial: true,\n    };\n\n    this.color = props.cropBackgroundColor || 'yellow';\n    this.opacity = props.cropBackgroundOpacity || 0.5;\n    this.strokeColor = props.cropOutlineColor || 'yellow';\n    this.strokeWidth = props.cropOutlineWidth || 5;\n    this.strokeDashArray = [5, 5];\n\n    this.keyboardHandler = this.keyboardHandler.bind(this);\n    this.addNew = this.addNew.bind(this);\n    this.deleteShapes = this.deleteShapes.bind(this);\n    this.multiSelect = this.multiSelect.bind(this);\n    this.discardActiveObject = this.discardActiveObject.bind(this);\n  }\n\n  componentDidMount(): void {\n    const { canvas } = this.state;\n    if (!canvas) {\n      this.initialCanvas();\n    }\n  }\n\n  componentDidUpdate(): void {\n    // this.changeImage();\n  }\n\n  changeImage(): void {\n    const { canvas } = this.state;\n    if (!canvas) {\n      return;\n    }\n    if (canvas.backgroundImage) {\n      return;\n    }\n    this.initialImage();\n  }\n\n  loadImage(img: fabric.Image): void {\n    const { initial, canvas } = this.state;\n    if (!canvas) {\n      return;\n    }\n    if (!canvas.width || !canvas.height || !img.height || !img.width) {\n      return;\n    }\n    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {\n      scaleX: canvas.width / img.width,\n      scaleY: canvas.height / img.height,\n    });\n    if (typeof initial === 'boolean' && initial) {\n      this.setState({ initial: false }, this.initialObjects.bind(this));\n    }\n  }\n\n  isCrossOriginURL(url: string): boolean {\n    const parts = url.match(this.REGEXP_ORIGINS);\n    return (\n      parts !== null &&\n      (parts[1] !== location.protocol ||\n        parts[2] !== location.hostname ||\n        parts[3] !== location.port)\n    );\n  }\n\n  initialImage(): void {\n    const { record, image } = this.props;\n    const loadImageNow = this.loadImage.bind(this);\n    if (typeof record === 'object' && record.image) {\n      const isCrossOrigin = this.isCrossOriginURL(record.image);\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const options: any = {};\n      if (isCrossOrigin) {\n        options.crossOrigin = 'Anonymous';\n      }\n      fabric.Image.fromURL(record.image, loadImageNow, options);\n    } else if (typeof image === 'string') {\n      const isCrossOrigin = this.isCrossOriginURL(image);\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const options: any = {};\n      if (isCrossOrigin) {\n        options.crossOrigin = 'Anonymous';\n      }\n      fabric.Image.fromURL(image, loadImageNow, options);\n    }\n  }\n\n  initialObjects(): void {\n    const { canvas } = this.state;\n    if (!canvas) {\n      return;\n    }\n    const { record, readonly } = this.props;\n    if (typeof record === 'object' && record) {\n      const setOutput = this.setOutput.bind(this);\n      const setStateOf = this.setState.bind(this);\n      const inputObject = record.clippings;\n      const createObject = this.createObject.bind(this);\n      if (\n        Array.isArray(inputObject) &&\n        inputObject.length > 0 &&\n        typeof inputObject[0] === 'object'\n      ) {\n        inputObject.forEach(function (coord) {\n          const rect = createObject(canvas, coord, readonly || false);\n          if (rect) {\n            canvas.add(rect);\n          }\n        });\n      }\n      canvas.renderAll();\n      setStateOf({ canvas }, setOutput);\n    } else {\n      console.log('Not have any record. Skipped.');\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/explicit-module-boundary-types\n  zoom(options: any): void {\n    const { canvas } = this.state;\n    if (!canvas) {\n      return;\n    }\n    const delta = options.e.deltaY;\n    let zoom = canvas.getZoom();\n    zoom *= 0.999 ** delta;\n    if (zoom > 20) zoom = 20;\n    if (zoom < 0.01) zoom = 0.01;\n    canvas.setZoom(zoom);\n    options.e.preventDefault();\n    options.e.stopPropagation();\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/explicit-module-boundary-types\n  mouseHover(options: any): void {\n    const { onHover } = this.props;\n    const converter = this.shapetoStructureData.bind(this);\n    const target = options.target;\n    if (target && target.type === 'rect' && onHover) {\n      const data = converter(target);\n      onHover(data);\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/explicit-module-boundary-types\n  mouseOut(options: any): void {\n    const { onHover } = this.props;\n    const target = options.target;\n    if (target && target.type === 'rect' && onHover) {\n      onHover(null);\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/explicit-module-boundary-types\n  selectionHandler(options: any): void {\n    const { onSelect } = this.props;\n    const converter = this.shapetoStructureData.bind(this);\n    const target = options.target;\n    if (target && target.type === 'rect' && onSelect) {\n      const data = converter(target);\n      onSelect(data);\n    }\n  }\n\n  selectionClearHandler(): void {\n    const { onSelect } = this.props;\n    if (onSelect) {\n      onSelect(null);\n    }\n  }\n\n  initialCanvas(): void {\n    const { id, width, height, readonly } = this.props;\n    const canvas = new fabric.Canvas(id || 'canvas', {\n      width: width,\n      height: height,\n    });\n    canvas.uniScaleTransform = true;\n    if (readonly) {\n      // readonly mode\n      canvas.selectionKey = undefined;\n      const mouseHoverHandler = this.mouseHover.bind(this);\n      const mouseHoverOutHandler = this.mouseOut.bind(this);\n      const selectionObjectHandler = this.selectionHandler.bind(this);\n      const selectionObjectClearHandler = this.selectionClearHandler.bind(this);\n      canvas.on('mouse:over', mouseHoverHandler);\n      canvas.on('mouse:out', mouseHoverOutHandler);\n      canvas.on('selection:created', selectionObjectHandler);\n      canvas.on('selection:updated', selectionObjectHandler);\n      canvas.on('selection:cleared', selectionObjectClearHandler);\n    } else {\n      // edit mode\n      const doubleClickEvent = this.doubleClickEvent.bind(this);\n      const objectModifiedEvent = this.setOutput.bind(this);\n      canvas.on('mouse:dblclick', doubleClickEvent);\n      canvas.on('object:modified', objectModifiedEvent);\n    }\n    const zoomHandler = this.zoom.bind(this);\n    canvas.on('mouse:wheel', zoomHandler);\n    // setup move drag: alt + click\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    canvas.on('mouse:down', function (opt: any) {\n      const evt = opt.e;\n      if (evt.altKey === true) {\n        this.isDragging = true;\n        this.selection = false;\n        this.lastPosX = evt.clientX;\n        this.lastPosY = evt.clientY;\n      }\n    });\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    canvas.on('mouse:move', function (opt: any) {\n      if (this.isDragging) {\n        const e = opt.e;\n        const vpt = this.viewportTransform;\n        vpt[4] += e.clientX - this.lastPosX;\n        vpt[5] += e.clientY - this.lastPosY;\n        this.requestRenderAll();\n        this.lastPosX = e.clientX;\n        this.lastPosY = e.clientY;\n      }\n    });\n    canvas.on('mouse:up', function () {\n      // on mouse up we want to recalculate new interaction\n      // for all objects, so we call setViewportTransform\n      this.setViewportTransform(this.viewportTransform);\n      this.isDragging = false;\n      this.selection = true;\n    });\n    const initialImg = this.initialImage.bind(this);\n    this.setState({ canvas }, initialImg);\n  }\n\n  addNew(): void {\n    const { canvas } = this.state;\n    if (!canvas) {\n      return;\n    }\n    const coor: ICoord = {\n      id: null,\n      rect: { x1: 0, y1: 0, x2: 0.2, y2: 0.2 },\n    };\n    const rect = this.createObject(canvas, coor, false);\n    if (!rect) {\n      return;\n    }\n    canvas.add(rect);\n    canvas.renderAll();\n    this.setState({ canvas }, this.setOutput);\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/explicit-module-boundary-types\n  doubleClickEvent(options: any): void {\n    const { canvas } = this.state;\n    if (!canvas) {\n      return;\n    }\n    if (typeof options === 'object' && typeof options.target === 'object' && options.target) {\n      const left = options.target.left;\n      const top = options.target.top;\n      const width = options.target.width;\n      const height = options.target.height;\n      const attribute: IAttribute = {\n        left: left + 50,\n        top: top + 50,\n        width: width * options.target.scaleX,\n        height: height * options.target.scaleY,\n      };\n      const rect = this.createObjectByAttribute(attribute);\n      canvas.add(rect);\n      canvas.renderAll();\n      this.setState({ canvas }, this.setOutput);\n    } else if (\n      typeof options === 'object' &&\n      typeof options.pointer === 'object' &&\n      options.pointer\n    ) {\n      const left = options.absolutePointer.x;\n      const top = options.absolutePointer.y;\n      const attribute: IAttribute = {\n        left: left,\n        top: top,\n        width: 100,\n        height: 100,\n      };\n      const rect = this.createObjectByAttribute(attribute);\n      canvas.add(rect);\n      canvas.renderAll();\n      this.setState({ canvas }, this.setOutput);\n    }\n  }\n\n  createObjectByAttribute(attribute: IAttribute): CustomFabricRect {\n    return new CustomFabricRect({\n      left: attribute.left,\n      top: attribute.top,\n      width: attribute.width,\n      height: attribute.height,\n      fill: this.color,\n      opacity: this.opacity,\n      id: null,\n      strokeDashArray: this.strokeDashArray,\n      stroke: this.strokeColor,\n      strokeWidth: this.strokeWidth,\n      lockRotation: true,\n    });\n  }\n\n  shapetoStructureData(element: CustomFabricRect): IOutputData | null {\n    const { canvas } = this.state;\n    if (!canvas) {\n      return null;\n    }\n    if (\n      !element.left ||\n      !element.top ||\n      !element.width ||\n      !element.height ||\n      !element.scaleX ||\n      !element.scaleY ||\n      !canvas.width ||\n      !canvas.height\n    ) {\n      return null;\n    }\n    const { includeDataUrl, includeHtmlCanvas } = this.props;\n    const x1 = element.left / canvas.width;\n    const y1 = element.top / canvas.height;\n    const x2 = (element.left + element.width * element.scaleX) / canvas.width;\n    const y2 = (element.top + element.height * element.scaleY) / canvas.height;\n    const rectangle = { x1: x1, y1: y1, x2: x2, y2: y2 };\n    const coord: IOutputData = {\n      id: element.id,\n      rect: JSON.stringify(rectangle),\n    };\n    if (\n      typeof canvas === 'object' &&\n      typeof canvas.backgroundImage === 'object' &&\n      canvas.backgroundImage\n    ) {\n      const canvasBackground = canvas.backgroundImage;\n      if (includeDataUrl) {\n        let dataUrl: string | null = null;\n        try {\n          dataUrl = canvasBackground.toDataURL({\n            height: element.getScaledHeight(),\n            width: element.getScaledWidth(),\n            left: element.left,\n            top: element.top,\n            format: 'jpeg',\n          });\n        } catch (error) {\n          console.log(error);\n        }\n        coord.dataUrl = dataUrl;\n      }\n      if (includeHtmlCanvas) {\n        let canvasElement = null;\n        try {\n          canvasElement = canvasBackground.toCanvasElement({\n            height: element.getScaledHeight(),\n            width: element.getScaledWidth(),\n            left: element.left,\n            top: element.top,\n          });\n        } catch (error) {\n          console.log(error);\n        }\n        coord.canvasElement = canvasElement;\n      }\n      if (canvasBackground.width && canvasBackground.height) {\n        const imgWidth = canvasBackground.width;\n        const imgHeight = canvasBackground.height;\n        const x1Px = x1 * imgWidth;\n        const x2Px = x2 * imgWidth;\n        const y1Px = y1 * imgHeight;\n        const y2Px = y2 * imgHeight;\n        const rectanglePx = {\n          x: x1Px,\n          y: y1Px,\n          x2: x2Px,\n          y2: y2Px,\n          w: x2Px - x1Px,\n          h: y2Px - y1Px,\n          boundX: imgWidth,\n          boundY: imgHeight,\n        };\n        coord.crop = JSON.stringify(rectanglePx);\n      }\n    }\n    coord.deletedAt = '-1';\n    return coord;\n  }\n\n  deleteShapes(): void {\n    const { readonly } = this.props;\n    const { canvas } = this.state;\n    if (canvas && !readonly) {\n      canvas.getActiveObjects().forEach(function (element) {\n        canvas.remove(element);\n      });\n      this.setState({ canvas }, this.setOutput);\n    }\n  }\n\n  setOutput(): void {\n    const { canvas } = this.state;\n    if (!canvas) {\n      return;\n    }\n    const shapeToStructureData = this.shapetoStructureData.bind(this);\n    const outputValue: Array<IOutputData> = [];\n    const cropcoords = canvas.getObjects('rect');\n    cropcoords.forEach(function (element: fabric.Object) {\n      const data = element as CustomFabricRect;\n      const outputData = shapeToStructureData(data);\n      if (outputData) {\n        outputValue.push(outputData);\n      }\n    });\n    // let stringOut = JSON.stringify(outputValue)\n    const { input } = this.props;\n    if (input) {\n      input.onChange(outputValue);\n    }\n  }\n\n  createObject(\n    canvas: fabric.Canvas | null,\n    coor: ICoord,\n    readonly: boolean,\n  ): CustomFabricRect | null {\n    if (!canvas) {\n      return null;\n    }\n    if (!canvas.width || !canvas.height) {\n      return null;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let rectangle: any;\n    if (typeof coor.rect === 'string') {\n      rectangle = JSON.parse(coor.rect);\n    } else {\n      rectangle = coor.rect;\n    }\n    const left = canvas.width * rectangle.x1;\n    const top = canvas.height * rectangle.y1;\n    const right = canvas.width * rectangle.x2;\n    const bottom = canvas.height * rectangle.y2;\n    const width = right - left;\n    const height = bottom - top;\n    return new CustomFabricRect({\n      left: left,\n      top: top,\n      width: width,\n      height: height,\n      fill: this.color,\n      opacity: this.opacity,\n      id: coor.id,\n      strokeDashArray: this.strokeDashArray,\n      stroke: this.strokeColor,\n      strokeWidth: this.strokeWidth,\n      lockRotation: true,\n      lockMovementX: readonly,\n      lockMovementY: readonly,\n      lockScalingX: readonly,\n      lockScalingY: readonly,\n    });\n  }\n\n  multiSelect(): void {\n    const { readonly } = this.props;\n    const { canvas } = this.state;\n    if (canvas && !readonly) {\n      canvas.discardActiveObject();\n      const sel = new fabric.ActiveSelection(canvas.getObjects(), {\n        canvas: canvas,\n      });\n      canvas.setActiveObject(sel);\n      canvas.requestRenderAll();\n    } else {\n      console.log('Canvas not defined');\n    }\n  }\n\n  discardActiveObject(): void {\n    const { canvas } = this.state;\n    if (canvas) {\n      canvas.discardActiveObject();\n      canvas.requestRenderAll();\n    } else {\n      console.log('Canvas not defined');\n    }\n  }\n\n  keyboardHandler(event: React.KeyboardEvent<HTMLDivElement>): void {\n    if (event.defaultPrevented) {\n      return;\n    }\n    let handled = false;\n    const key = event.key || event.keyCode;\n    if (key === 'Delete' || key === 46) {\n      // Handle Delete\n      this.deleteShapes();\n      handled = true;\n    } else if (event.ctrlKey && (key === 65 || key === 'a')) {\n      this.multiSelect();\n      handled = true;\n    }\n    if (handled) {\n      // Suppress \"double action\" if event handled\n      event.preventDefault();\n    }\n  }\n\n  render(): JSX.Element {\n    const { input, source, showLabel, showButton, id, width, height, readonly } = this.props;\n    const renderInputRedux = !!input;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/explicit-module-boundary-types\n    let valueForm: any;\n    let nameForm = source;\n    if (input) {\n      const { value, name } = input;\n      valueForm = value;\n      nameForm = name;\n    }\n\n    return (\n      <div id=\"canvas-wrapper\">\n        {showLabel && <div className=\"label\">{nameForm}</div>}\n\n        <Grid container direction=\"row\" justify=\"flex-start\" alignItems=\"flex-start\">\n          <Grid item xs onKeyDown={!readonly ? this.keyboardHandler : undefined} tabIndex={0}>\n            <canvas id={id} width={width} height={height} style={{ border: '0px solid #aaa' }} />\n          </Grid>\n          {showButton && !readonly && (\n            <Grid container item xs direction=\"column\" justify=\"flex-start\" alignItems=\"flex-start\">\n              <Grid item xs>\n                <Button variant=\"contained\" id=\"addmore\" color=\"primary\" onClick={this.addNew}>\n                  {' '}\n                  Add More Shapes\n                </Button>\n              </Grid>\n              <Grid item xs>\n                <Button\n                  variant=\"contained\"\n                  id=\"deleteselected\"\n                  color=\"primary\"\n                  onClick={this.deleteShapes}\n                >\n                  {' '}\n                  Delete Selected Object{' '}\n                </Button>\n              </Grid>\n              <Grid item xs>\n                <Button\n                  variant=\"contained\"\n                  id=\"multiselect\"\n                  color=\"primary\"\n                  onClick={this.multiSelect}\n                >\n                  {' '}\n                  Select All{' '}\n                </Button>\n              </Grid>\n              <Grid item xs>\n                <Button\n                  variant=\"contained\"\n                  id=\"discard\"\n                  color=\"primary\"\n                  onClick={this.discardActiveObject}\n                >\n                  {' '}\n                  Discard Selection\n                </Button>\n              </Grid>\n            </Grid>\n          )}\n          {renderInputRedux && <input type=\"hidden\" value={valueForm} />}\n        </Grid>\n      </div>\n    );\n  }\n}\n\nexport default ReactMultiCrop;\n"],"names":["options","_super","_this","id","__extends","fabric","Rect","props","state","canvas","initial","color","cropBackgroundColor","opacity","cropBackgroundOpacity","strokeColor","cropOutlineColor","strokeWidth","cropOutlineWidth","strokeDashArray","keyboardHandler","bind","addNew","deleteShapes","multiSelect","discardActiveObject","ReactMultiCrop","this","initialCanvas","backgroundImage","initialImage","img","_a","width","height","setBackgroundImage","renderAll","scaleX","scaleY","setState","initialObjects","url","parts","match","REGEXP_ORIGINS","location","protocol","hostname","port","record","image","loadImageNow","loadImage","_typeof","isCrossOriginURL","crossOrigin","Image","fromURL","readonly","setOutput","setStateOf","inputObject","clippings","createObject_1","createObject","Array","isArray","length","forEach","coord","rect","add","console","log","delta","e","deltaY","zoom","getZoom","Math","setZoom","preventDefault","stopPropagation","onHover","converter","shapetoStructureData","target","type","onSelect","Canvas","uniScaleTransform","selectionKey","undefined","mouseHoverHandler","mouseHover","mouseHoverOutHandler","mouseOut","selectionObjectHandler","selectionHandler","selectionObjectClearHandler","selectionClearHandler","on","doubleClickEvent","objectModifiedEvent","zoomHandler","opt","evt","altKey","isDragging","selection","lastPosX","clientX","lastPosY","clientY","vpt","viewportTransform","requestRenderAll","setViewportTransform","initialImg","x1","y1","x2","y2","left","top_1","top","attribute","createObjectByAttribute","pointer","absolutePointer","x","y","CustomFabricRect","fill","stroke","lockRotation","element","includeDataUrl","includeHtmlCanvas","rectangle","JSON","stringify","canvasBackground","dataUrl","toDataURL","getScaledHeight","getScaledWidth","format","error","canvasElement","toCanvasElement","imgWidth","imgHeight","x1Px","x2Px","y1Px","y2Px","rectanglePx","w","h","boundX","boundY","crop","deletedAt","getActiveObjects","remove","shapeToStructureData","outputValue","getObjects","outputData","push","input","onChange","coor","parse","right","bottom","lockMovementX","lockMovementY","lockScalingX","lockScalingY","sel","ActiveSelection","setActiveObject","event","defaultPrevented","handled","key","keyCode","ctrlKey","valueForm","source","showLabel","showButton","renderInputRedux","nameForm","React","className","Grid","container","direction","justify","alignItems","item","xs","onKeyDown","tabIndex","style","border","Button","variant","onClick","value","Component"],"mappings":";;;;;;;;;;;;;;2ZA0EA,6BAEcA,SACVC,YAAMD,gBAFDE,KAAoB,KAGrBF,IACFE,EAAKC,GAAKH,EAAQG,aALcC,UAAAC,EAAOC,+BAwC/BC,SACVN,YAAMM,gBAHAL,iBAAiB,gCAKvBA,EAAKM,MAAQ,CACXC,OAAQ,KACRC,SAAS,GAGXR,EAAKS,MAAQJ,EAAMK,qBAAuB,SAC1CV,EAAKW,QAAUN,EAAMO,uBAAyB,GAC9CZ,EAAKa,YAAcR,EAAMS,kBAAoB,SAC7Cd,EAAKe,YAAcV,EAAMW,kBAAoB,EAC7ChB,EAAKiB,gBAAkB,CAAC,EAAG,GAE3BjB,EAAKkB,gBAAkBlB,EAAKkB,gBAAgBC,KAAKnB,GACjDA,EAAKoB,OAASpB,EAAKoB,OAAOD,KAAKnB,GAC/BA,EAAKqB,aAAerB,EAAKqB,aAAaF,KAAKnB,GAC3CA,EAAKsB,YAActB,EAAKsB,YAAYH,KAAKnB,GACzCA,EAAKuB,oBAAsBvB,EAAKuB,oBAAoBJ,KAAKnB,YAhDhCE,OAmD3BsB,8BAAA,WACqBC,KAAKnB,mBAEjBoB,iBAITF,+BAAA,aAIAA,wBAAA,eACUjB,EAAWkB,KAAKnB,aACnBC,IAGDA,EAAOoB,sBAGNC,iBAGPJ,sBAAA,SAAUK,OACFC,EAAsBL,KAAKnB,MAAzBE,YAASD,WACZA,GAGAA,EAAOwB,OAAUxB,EAAOyB,QAAWH,EAAIG,QAAWH,EAAIE,QAG3DxB,EAAO0B,mBAAmBJ,EAAKtB,EAAO2B,UAAUf,KAAKZ,GAAS,CAC5D4B,OAAQ5B,EAAOwB,MAAQF,EAAIE,MAC3BK,OAAQ7B,EAAOyB,OAASH,EAAIG,SAEP,kBAAZxB,GAAyBA,QAC7B6B,SAAS,CAAE7B,SAAS,GAASiB,KAAKa,eAAenB,KAAKM,SAI/DD,6BAAA,SAAiBe,OACTC,EAAQD,EAAIE,MAAMhB,KAAKiB,uBAEjB,OAAVF,IACCA,EAAM,KAAOG,SAASC,UACrBJ,EAAM,KAAOG,SAASE,UACtBL,EAAM,KAAOG,SAASG,OAI5BtB,yBAAA,eACQM,EAAoBL,KAAKpB,MAAvB0C,WAAQC,UACVC,EAAexB,KAAKyB,UAAU/B,KAAKM,SACnB,WAAlB0B,EAAOJ,IAAuBA,EAAOC,MAAO,KAGxClD,EAAe,GAFC2B,KAAK2B,iBAAiBL,EAAOC,SAIjDlD,EAAQuD,YAAc,aAExBlD,EAAOmD,MAAMC,QAAQR,EAAOC,MAAOC,EAAcnD,QAC5C,GAAqB,iBAAVkD,EAAoB,CAG9BlD,EAAe,GAFC2B,KAAK2B,iBAAiBJ,KAI1ClD,EAAQuD,YAAc,aAExBlD,EAAOmD,MAAMC,QAAQP,EAAOC,EAAcnD,KAI9C0B,2BAAA,eACUjB,EAAWkB,KAAKnB,gBACnBC,OAGCuB,EAAuBL,KAAKpB,MAA1B0C,WAAQS,gBACM,WAAlBL,EAAOJ,IAAuBA,EAAQ,KAClCU,EAAYhC,KAAKgC,UAAUtC,KAAKM,MAChCiC,EAAajC,KAAKY,SAASlB,KAAKM,MAChCkC,EAAcZ,EAAOa,UACrBC,EAAepC,KAAKqC,aAAa3C,KAAKM,MAE1CsC,MAAMC,QAAQL,IACdA,EAAYM,OAAS,GACK,WAA1Bd,EAAOQ,EAAY,KAEnBA,EAAYO,SAAQ,SAAUC,OACtBC,EAAOP,EAAatD,EAAQ4D,EAAOX,IAAY,GACjDY,GACF7D,EAAO8D,IAAID,MAIjB7D,EAAO2B,YACPwB,EAAW,CAAEnD,UAAUkD,QAEvBa,QAAQC,IAAI,mCAKhB/C,iBAAA,SAAK1B,OACKS,EAAWkB,KAAKnB,gBACnBC,OAGCiE,EAAQ1E,EAAQ2E,EAAEC,OACpBC,EAAOpE,EAAOqE,WAClBD,GAAQE,SAAA,KAASL,IACN,KAAIG,EAAO,IAClBA,EAAO,MAAMA,EAAO,KACxBpE,EAAOuE,QAAQH,GACf7E,EAAQ2E,EAAEM,iBACVjF,EAAQ2E,EAAEO,oBAIZxD,uBAAA,SAAW1B,OACDmF,EAAYxD,KAAKpB,cACnB6E,EAAYzD,KAAK0D,qBAAqBhE,KAAKM,MAC3C2D,EAAStF,EAAQsF,OACnBA,GAA0B,SAAhBA,EAAOC,MAAmBJ,GAEtCA,EADaC,EAAUE,KAM3B5D,qBAAA,SAAS1B,OACCmF,EAAYxD,KAAKpB,cACnB+E,EAAStF,EAAQsF,OACnBA,GAA0B,SAAhBA,EAAOC,MAAmBJ,GACtCA,EAAQ,OAKZzD,6BAAA,SAAiB1B,OACPwF,EAAa7D,KAAKpB,eACpB6E,EAAYzD,KAAK0D,qBAAqBhE,KAAKM,MAC3C2D,EAAStF,EAAQsF,OACnBA,GAA0B,SAAhBA,EAAOC,MAAmBC,GAEtCA,EADaJ,EAAUE,KAK3B5D,kCAAA,eACU8D,EAAa7D,KAAKpB,eACtBiF,GACFA,EAAS,OAIb9D,0BAAA,eACQM,EAAkCL,KAAKpB,MAArCJ,OAAI8B,UAAOC,WAAQwB,aACrBjD,EAAS,IAAIJ,EAAOoF,OAAOtF,GAAM,SAAU,CAC/C8B,MAAOA,EACPC,OAAQA,OAEVzB,EAAOiF,mBAAoB,EACvBhC,EAAU,CAEZjD,EAAOkF,kBAAeC,MAChBC,EAAoBlE,KAAKmE,WAAWzE,KAAKM,MACzCoE,EAAuBpE,KAAKqE,SAAS3E,KAAKM,MAC1CsE,EAAyBtE,KAAKuE,iBAAiB7E,KAAKM,MACpDwE,EAA8BxE,KAAKyE,sBAAsB/E,KAAKM,MACpElB,EAAO4F,GAAG,aAAcR,GACxBpF,EAAO4F,GAAG,YAAaN,GACvBtF,EAAO4F,GAAG,oBAAqBJ,GAC/BxF,EAAO4F,GAAG,oBAAqBJ,GAC/BxF,EAAO4F,GAAG,oBAAqBF,OAC1B,KAECG,EAAmB3E,KAAK2E,iBAAiBjF,KAAKM,MAC9C4E,EAAsB5E,KAAKgC,UAAUtC,KAAKM,MAChDlB,EAAO4F,GAAG,iBAAkBC,GAC5B7F,EAAO4F,GAAG,kBAAmBE,OAEzBC,EAAc7E,KAAKkD,KAAKxD,KAAKM,MACnClB,EAAO4F,GAAG,cAAeG,GAGzB/F,EAAO4F,GAAG,cAAc,SAAUI,OAC1BC,EAAMD,EAAI9B,GACG,IAAf+B,EAAIC,cACDC,YAAa,OACbC,WAAY,OACZC,SAAWJ,EAAIK,aACfC,SAAWN,EAAIO,YAIxBxG,EAAO4F,GAAG,cAAc,SAAUI,MAC5B9E,KAAKiF,WAAY,KACbjC,EAAI8B,EAAI9B,EACRuC,EAAMvF,KAAKwF,kBACjBD,EAAI,IAAMvC,EAAEoC,QAAUpF,KAAKmF,SAC3BI,EAAI,IAAMvC,EAAEsC,QAAUtF,KAAKqF,cACtBI,wBACAN,SAAWnC,EAAEoC,aACbC,SAAWrC,EAAEsC,YAGtBxG,EAAO4F,GAAG,YAAY,gBAGfgB,qBAAqB1F,KAAKwF,wBAC1BP,YAAa,OACbC,WAAY,SAEbS,EAAa3F,KAAKG,aAAaT,KAAKM,WACrCY,SAAS,CAAE9B,UAAU6G,IAG5B5F,mBAAA,eACUjB,EAAWkB,KAAKnB,gBACnBC,OAOC6D,EAAO3C,KAAKqC,aAAavD,EAJV,CACnBN,GAAI,KACJmE,KAAM,CAAEiD,GAAI,EAAGC,GAAI,EAAGC,GAAI,GAAKC,GAAI,MAEQ,GACxCpD,IAGL7D,EAAO8D,IAAID,GACX7D,EAAO2B,iBACFG,SAAS,CAAE9B,UAAUkB,KAAKgC,cAIjCjC,6BAAA,SAAiB1B,OACPS,EAAWkB,KAAKnB,gBACnBC,KAGkB,WAAnB4C,EAAOrD,IAAkD,WAA1BqD,EAAOrD,EAAQsF,SAAuBtF,EAAQsF,OAAQ,KACjFqC,EAAO3H,EAAQsF,OAAOqC,KACtBC,EAAM5H,EAAQsF,OAAOuC,IACrB5F,EAAQjC,EAAQsF,OAAOrD,MACvBC,EAASlC,EAAQsF,OAAOpD,OACxB4F,EAAwB,CAC5BH,KAAMA,EAAO,GACbE,IAAKD,EAAM,GACX3F,MAAOA,EAAQjC,EAAQsF,OAAOjD,OAC9BH,OAAQA,EAASlC,EAAQsF,OAAOhD,QAE5BgC,EAAO3C,KAAKoG,wBAAwBD,GAC1CrH,EAAO8D,IAAID,GACX7D,EAAO2B,iBACFG,SAAS,CAAE9B,UAAUkB,KAAKgC,gBAC1B,GACc,WAAnBN,EAAOrD,IACoB,WAA3BqD,EAAOrD,EAAQgI,UACfhI,EAAQgI,QACR,CAGMF,EAAwB,CAC5BH,KAHIA,EAAO3H,EAAQiI,gBAAgBC,EAInCL,IAHU7H,EAAQiI,gBAAgBE,EAIlClG,MAAO,IACPC,OAAQ,KAEJoC,EAAO3C,KAAKoG,wBAAwBD,GAC1CrH,EAAO8D,IAAID,GACX7D,EAAO2B,iBACFG,SAAS,CAAE9B,UAAUkB,KAAKgC,aAInCjC,oCAAA,SAAwBoG,UACf,IAAIM,EAAiB,CAC1BT,KAAMG,EAAUH,KAChBE,IAAKC,EAAUD,IACf5F,MAAO6F,EAAU7F,MACjBC,OAAQ4F,EAAU5F,OAClBmG,KAAM1G,KAAKhB,MACXE,QAASc,KAAKd,QACdV,GAAI,KACJgB,gBAAiBQ,KAAKR,gBACtBmH,OAAQ3G,KAAKZ,YACbE,YAAaU,KAAKV,YAClBsH,cAAc,KAIlB7G,iCAAA,SAAqB8G,OACX/H,EAAWkB,KAAKnB,iBACnBC,SACI,UAGN+H,EAAQb,MACRa,EAAQX,KACRW,EAAQvG,OACRuG,EAAQtG,QACRsG,EAAQnG,QACRmG,EAAQlG,QACR7B,EAAOwB,OACPxB,EAAOyB,eAED,SAEHF,EAAwCL,KAAKpB,MAA3CkI,mBAAgBC,sBAClBnB,EAAKiB,EAAQb,KAAOlH,EAAOwB,MAC3BuF,EAAKgB,EAAQX,IAAMpH,EAAOyB,OAC1BuF,GAAMe,EAAQb,KAAOa,EAAQvG,MAAQuG,EAAQnG,QAAU5B,EAAOwB,MAC9DyF,GAAMc,EAAQX,IAAMW,EAAQtG,OAASsG,EAAQlG,QAAU7B,EAAOyB,OAC9DyG,EAAY,CAAEpB,GAAIA,EAAIC,GAAIA,EAAIC,GAAIA,EAAIC,GAAIA,GAC1CrD,EAAqB,CACzBlE,GAAIqI,EAAQrI,GACZmE,KAAMsE,KAAKC,UAAUF,OAGH,WAAlBtF,EAAO5C,IAC2B,WAAlC4C,EAAO5C,EAAOoB,kBACdpB,EAAOoB,gBACP,KACMiH,EAAmBrI,EAAOoB,mBAC5B4G,EAAgB,KACdM,EAAyB,SAE3BA,EAAUD,EAAiBE,UAAU,CACnC9G,OAAQsG,EAAQS,kBAChBhH,MAAOuG,EAAQU,iBACfvB,KAAMa,EAAQb,KACdE,IAAKW,EAAQX,IACbsB,OAAQ,SAEV,MAAOC,GACP5E,QAAQC,IAAI2E,GAEd/E,EAAM0E,QAAUA,KAEdL,EAAmB,KACjBW,EAAgB,SAElBA,EAAgBP,EAAiBQ,gBAAgB,CAC/CpH,OAAQsG,EAAQS,kBAChBhH,MAAOuG,EAAQU,iBACfvB,KAAMa,EAAQb,KACdE,IAAKW,EAAQX,MAEf,MAAOuB,GACP5E,QAAQC,IAAI2E,GAEd/E,EAAMgF,cAAgBA,KAEpBP,EAAiB7G,OAAS6G,EAAiB5G,OAAQ,KAC/CqH,EAAWT,EAAiB7G,MAC5BuH,EAAYV,EAAiB5G,OAC7BuH,EAAOlC,EAAKgC,EACZG,EAAOjC,EAAK8B,EACZI,EAAOnC,EAAKgC,EACZI,EAAOlC,EAAK8B,EACZK,EAAc,CAClB3B,EAAGuB,EACHtB,EAAGwB,EACHlC,GAAIiC,EACJhC,GAAIkC,EACJE,EAAGJ,EAAOD,EACVM,EAAGH,EAAOD,EACVK,OAAQT,EACRU,OAAQT,GAEVnF,EAAM6F,KAAOtB,KAAKC,UAAUgB,WAGhCxF,EAAM8F,UAAY,KACX9F,GAGT3C,yBAAA,eACUgC,EAAa/B,KAAKpB,eAClBE,EAAWkB,KAAKnB,aACpBC,IAAWiD,IACbjD,EAAO2J,mBAAmBhG,SAAQ,SAAUoE,GAC1C/H,EAAO4J,OAAO7B,WAEXjG,SAAS,CAAE9B,UAAUkB,KAAKgC,aAInCjC,sBAAA,eACUjB,EAAWkB,KAAKnB,gBACnBC,OAGC6J,EAAuB3I,KAAK0D,qBAAqBhE,KAAKM,MACtD4I,EAAkC,GACrB9J,EAAO+J,WAAW,QAC1BpG,SAAQ,SAAUoE,OAErBiC,EAAaH,EADN9B,GAETiC,GACFF,EAAYG,KAAKD,UAIbE,EAAUhJ,KAAKpB,YACnBoK,GACFA,EAAMC,SAASL,KAInB7I,yBAAA,SACEjB,EACAoK,EACAnH,OAEKjD,SACI,SAEJA,EAAOwB,QAAUxB,EAAOyB,cACpB,SAGLyG,EAEFA,EADuB,iBAAdkC,EAAKvG,KACFsE,KAAKkC,MAAMD,EAAKvG,MAEhBuG,EAAKvG,SAEbqD,EAAOlH,EAAOwB,MAAQ0G,EAAUpB,GAChCM,EAAMpH,EAAOyB,OAASyG,EAAUnB,GAChCuD,EAAQtK,EAAOwB,MAAQ0G,EAAUlB,GACjCuD,EAASvK,EAAOyB,OAASyG,EAAUjB,UAGlC,IAAIU,EAAiB,CAC1BT,KAAMA,EACNE,IAAKA,EACL5F,MALY8I,EAAQpD,EAMpBzF,OALa8I,EAASnD,EAMtBQ,KAAM1G,KAAKhB,MACXE,QAASc,KAAKd,QACdV,GAAI0K,EAAK1K,GACTgB,gBAAiBQ,KAAKR,gBACtBmH,OAAQ3G,KAAKZ,YACbE,YAAaU,KAAKV,YAClBsH,cAAc,EACd0C,cAAevH,EACfwH,cAAexH,EACfyH,aAAczH,EACd0H,aAAc1H,KAIlBhC,wBAAA,eACUgC,EAAa/B,KAAKpB,eAClBE,EAAWkB,KAAKnB,gBACpBC,IAAWiD,EAAU,CACvBjD,EAAOgB,0BACD4J,EAAM,IAAIhL,EAAOiL,gBAAgB7K,EAAO+J,aAAc,CAC1D/J,OAAQA,IAEVA,EAAO8K,gBAAgBF,GACvB5K,EAAO2G,wBAEP5C,QAAQC,IAAI,uBAIhB/C,gCAAA,eACUjB,EAAWkB,KAAKnB,aACpBC,GACFA,EAAOgB,sBACPhB,EAAO2G,oBAEP5C,QAAQC,IAAI,uBAIhB/C,4BAAA,SAAgB8J,OACVA,EAAMC,sBAGNC,GAAU,EACRC,EAAMH,EAAMG,KAAOH,EAAMI,QACnB,WAARD,GAA4B,KAARA,QAEjBpK,eACLmK,GAAU,IACDF,EAAMK,SAAoB,KAARF,GAAsB,MAARA,SACpCnK,cACLkK,GAAU,GAERA,GAEFF,EAAMvG,mBAIVvD,mBAAA,eAIMoK,EAHE9J,EAAwEL,KAAKpB,MAA3EoK,UAAOoB,WAAQC,cAAWC,eAAY9L,OAAI8B,UAAOC,WAAQwB,aAC3DwI,IAAqBvB,EAGvBwB,EAAWJ,EACXpB,IAEFmB,EADwBnB,QAExBwB,EAFwBxB,eAMxByB,uBAAKjM,GAAG,kBACL6L,GAAaI,uBAAKC,UAAU,SAASF,GAEtCC,gBAACE,GAAKC,aAAUC,UAAU,MAAMC,QAAQ,aAAaC,WAAW,cAC9DN,gBAACE,GAAKK,QAAKC,MAAGC,UAAYnJ,OAAkCkC,EAAvBjE,KAAKP,gBAA6B0L,SAAU,GAC/EV,0BAAQjM,GAAIA,EAAI8B,MAAOA,EAAOC,OAAQA,EAAQ6K,MAAO,CAAEC,OAAQ,qBAEhEf,IAAevI,GACd0I,gBAACE,GAAKC,aAAUI,QAAKC,MAAGJ,UAAU,SAASC,QAAQ,aAAaC,WAAW,cACzEN,gBAACE,GAAKK,QAAKC,OACTR,gBAACa,GAAOC,QAAQ,YAAY/M,GAAG,UAAUQ,MAAM,UAAUwM,QAASxL,KAAKL,QACpE,wBAIL8K,gBAACE,GAAKK,QAAKC,OACTR,gBAACa,GACCC,QAAQ,YACR/M,GAAG,iBACHQ,MAAM,UACNwM,QAASxL,KAAKJ,cAEb,6BACsB,MAG3B6K,gBAACE,GAAKK,QAAKC,OACTR,gBAACa,GACCC,QAAQ,YACR/M,GAAG,cACHQ,MAAM,UACNwM,QAASxL,KAAKH,aAEb,iBACU,MAGf4K,gBAACE,GAAKK,QAAKC,OACTR,gBAACa,GACCC,QAAQ,YACR/M,GAAG,UACHQ,MAAM,UACNwM,QAASxL,KAAKF,qBAEb,2BAMRyK,GAAoBE,yBAAO7G,KAAK,SAAS6H,MAAOtB,OApmB3CpK,eAAe,CAC3BvB,GAAI,SACJ8B,MAAO,IACPC,OAAQ,IACRyI,MAAO,KACPoB,OAAQ,kBACR9I,OAAQ,CACNC,MAAO,KACPY,UAAW,IAEbZ,MAAO,KACPtC,oBAAqB,SACrBE,sBAAuB,GACvBE,iBAAkB,SAClBE,iBAAkB,EAClBwC,UAAU,EACVsI,WAAW,EACXC,YAAY,EACZxD,gBAAgB,EAChBC,mBAAmB,MApBM2E"}