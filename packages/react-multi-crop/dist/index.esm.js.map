{"version":3,"file":"index.esm.js","sources":["../src/ReactMultiCrop/ReactMultiCrop.tsx"],"sourcesContent":["import React, { Component } from \"react\";\r\nimport { fabric } from \"fabric\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\n\r\nexport interface IRecordProps {\r\n  image: string;\r\n  clippings: Array<any>;\r\n}\r\n\r\nexport interface IOutputData extends ICoord {\r\n  crop?: string;\r\n  deletedAt?: string;\r\n  dataUrl?: string | null;\r\n  canvasElement?: HTMLCanvasElement | null;\r\n}\r\n\r\nexport interface IInputProps {\r\n  value: string | any;\r\n  name: string;\r\n  onChange(value: Array<IOutputData>): void;\r\n}\r\n\r\nexport interface IReactMultiCropProps {\r\n  id?: string;\r\n  width?: number;\r\n  height?: number;\r\n  source?: string;\r\n  input?: IInputProps;\r\n  record?: IRecordProps;\r\n  image?: string;\r\n  cropBackgroundColor?: string;\r\n  cropBackgroundOpacity?: number;\r\n  cropOutlineColor?: string;\r\n  cropOutlineWidth?: number;\r\n  showLabel?: boolean;\r\n  showButton?: boolean;\r\n  includeDataUrl?: boolean;\r\n  includeHtmlCanvas?: boolean;\r\n}\r\n\r\nexport interface IReactMultiCropStates {\r\n  canvas: fabric.Canvas | null;\r\n  initial: boolean;\r\n}\r\n\r\nexport interface IRectCoord {\r\n  x1: number;\r\n  x2: number;\r\n  y1: number;\r\n  y2: number;\r\n}\r\n\r\nexport interface ICoord {\r\n  id: string | null;\r\n  rect: IRectCoord | string;\r\n}\r\n\r\nexport interface IAttribute {\r\n  left: number;\r\n  top: number;\r\n  height: number;\r\n  width: number;\r\n}\r\n\r\nexport interface ICustomFabricRect extends fabric.IRectOptions {\r\n  id: string | null;\r\n}\r\n\r\nexport class CustomFabricRect extends fabric.Rect {\r\n  public id: string | null = null;\r\n  constructor(options?: ICustomFabricRect) {\r\n    super(options);\r\n    if (options) {\r\n      this.id = options.id;\r\n    }\r\n  }\r\n}\r\n\r\nclass ReactMultiCrop extends Component<IReactMultiCropProps, IReactMultiCropStates> {\r\n  public static defaultProps = {\r\n    id: \"canvas\",\r\n    width: 800,\r\n    height: 800,\r\n    input: null,\r\n    source: \"react-crop-form\",\r\n    record: {\r\n      image: null,\r\n      clippings: [],\r\n    },\r\n    image: null,\r\n    cropBackgroundColor: \"yellow\",\r\n    cropBackgroundOpacity: 0.5,\r\n    cropOutlineColor: \"yellow\",\r\n    cropOutlineWidth: 5,\r\n    showLabel: false,\r\n    showButton: false,\r\n    includeDataUrl: false,\r\n    includeHtmlCanvas: false,\r\n  };\r\n\r\n  private color: string;\r\n  private opacity: number;\r\n  private strokeColor: string;\r\n  private strokeWidth: number;\r\n  private strokeDashArray: Array<number>;\r\n  private REGEXP_ORIGINS = /^(\\w+:)\\/\\/([^:/?#]*):?(\\d*)/i;\r\n\r\n  constructor(props: IReactMultiCropProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      canvas: null,\r\n      initial: true,\r\n    };\r\n\r\n    this.color = props.cropBackgroundColor || \"yellow\";\r\n    this.opacity = props.cropBackgroundOpacity || 0.5;\r\n    this.strokeColor = props.cropOutlineColor || \"yellow\";\r\n    this.strokeWidth = props.cropOutlineWidth || 5;\r\n    this.strokeDashArray = [5, 5];\r\n\r\n    this.keyboardHandler = this.keyboardHandler.bind(this);\r\n    this.addNew = this.addNew.bind(this);\r\n    this.deleteShapes = this.deleteShapes.bind(this);\r\n    this.multiSelect = this.multiSelect.bind(this);\r\n    this.discardActiveObject = this.discardActiveObject.bind(this);\r\n  }\r\n\r\n  componentDidMount(): void {\r\n    const { canvas } = this.state;\r\n    if (!canvas) {\r\n      this.initialCanvas();\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(): void {\r\n    // this.changeImage();\r\n  }\r\n\r\n  changeImage(): void {\r\n    const { canvas } = this.state;\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n    if (canvas.backgroundImage) {\r\n      return;\r\n    }\r\n    this.initialImage();\r\n  }\r\n\r\n  loadImage(img: fabric.Image): void {\r\n    const { initial, canvas } = this.state;\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n    if (!canvas.width || !canvas.height || !img.height || !img.width) {\r\n      return;\r\n    }\r\n    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {\r\n      scaleX: canvas.width / img.width,\r\n      scaleY: canvas.height / img.height,\r\n    });\r\n    if (typeof initial === \"boolean\" && initial) {\r\n      this.setState({ initial: false }, this.initialObjects.bind(this));\r\n    }\r\n  }\r\n\r\n  isCrossOriginURL(url: string): boolean {\r\n    const parts = url.match(this.REGEXP_ORIGINS);\r\n    return (\r\n      parts !== null && (parts[1] !== location.protocol || parts[2] !== location.hostname || parts[3] !== location.port)\r\n    );\r\n  }\r\n\r\n  initialImage(): void {\r\n    const { record, image } = this.props;\r\n    const loadImageNow = this.loadImage.bind(this);\r\n    if (typeof record === \"object\" && record.image) {\r\n      const isCrossOrigin = this.isCrossOriginURL(record.image);\r\n      const options: any = {};\r\n      if (isCrossOrigin) {\r\n        options.crossOrigin = \"Anonymous\";\r\n      }\r\n      fabric.Image.fromURL(record.image, loadImageNow, options);\r\n    } else if (typeof image === \"string\") {\r\n      const isCrossOrigin = this.isCrossOriginURL(image);\r\n      const options: any = {};\r\n      if (isCrossOrigin) {\r\n        options.crossOrigin = \"Anonymous\";\r\n      }\r\n      fabric.Image.fromURL(image, loadImageNow, options);\r\n    }\r\n  }\r\n\r\n  initialObjects(): void {\r\n    const { canvas } = this.state;\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n    const { record } = this.props;\r\n    if (typeof record === \"object\" && record) {\r\n      const setOutput = this.setOutput.bind(this);\r\n      const setStateOf = this.setState.bind(this);\r\n      const inputObject = record.clippings;\r\n      const createObject = this.createObject.bind(this);\r\n      if (Array.isArray(inputObject) && inputObject.length > 0 && typeof inputObject[0] === \"object\") {\r\n        inputObject.forEach(function (coord) {\r\n          const rect = createObject(canvas, coord);\r\n          if (rect) {\r\n            canvas.add(rect);\r\n          }\r\n        });\r\n      }\r\n      canvas.renderAll();\r\n      setStateOf({ canvas }, setOutput);\r\n    } else {\r\n      console.log(\"Not have any record. Skipped.\");\r\n    }\r\n  }\r\n\r\n  zoom(options: any): void {\r\n    const { canvas } = this.state;\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n    const delta = options.e.deltaY;\r\n    let zoom = canvas.getZoom();\r\n    zoom *= 0.999 ** delta;\r\n    if (zoom > 20) zoom = 20;\r\n    if (zoom < 0.01) zoom = 0.01;\r\n    canvas.setZoom(zoom);\r\n    options.e.preventDefault();\r\n    options.e.stopPropagation();\r\n  }\r\n\r\n  initialCanvas(): void {\r\n    const { id, width, height } = this.props;\r\n    const canvas = new fabric.Canvas(id || \"canvas\", {\r\n      width: width,\r\n      height: height,\r\n    });\r\n    canvas.uniScaleTransform = true;\r\n    const doubleClickEvent = this.doubleClickEvent.bind(this);\r\n    const objectModifiedEvent = this.setOutput.bind(this);\r\n    const zoomHandler = this.zoom.bind(this);\r\n    canvas.on(\"mouse:dblclick\", doubleClickEvent);\r\n    canvas.on(\"object:modified\", objectModifiedEvent);\r\n    canvas.on(\"mouse:wheel\", zoomHandler);\r\n    // setup move drag: alt + click\r\n    canvas.on(\"mouse:down\", function (opt: any) {\r\n      const evt = opt.e;\r\n      if (evt.altKey === true) {\r\n        this.isDragging = true;\r\n        this.selection = false;\r\n        this.lastPosX = evt.clientX;\r\n        this.lastPosY = evt.clientY;\r\n      }\r\n    });\r\n    canvas.on(\"mouse:move\", function (opt: any) {\r\n      if (this.isDragging) {\r\n        const e = opt.e;\r\n        const vpt = this.viewportTransform;\r\n        vpt[4] += e.clientX - this.lastPosX;\r\n        vpt[5] += e.clientY - this.lastPosY;\r\n        this.requestRenderAll();\r\n        this.lastPosX = e.clientX;\r\n        this.lastPosY = e.clientY;\r\n      }\r\n    });\r\n    canvas.on(\"mouse:up\", function () {\r\n      // on mouse up we want to recalculate new interaction\r\n      // for all objects, so we call setViewportTransform\r\n      this.setViewportTransform(this.viewportTransform);\r\n      this.isDragging = false;\r\n      this.selection = true;\r\n    });\r\n    const initialImg = this.initialImage.bind(this);\r\n    this.setState({ canvas }, initialImg);\r\n  }\r\n\r\n  addNew(): void {\r\n    const { canvas } = this.state;\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n    const coor: ICoord = {\r\n      id: null,\r\n      rect: { x1: 0, y1: 0, x2: 0.2, y2: 0.2 },\r\n    };\r\n    const rect = this.createObject(canvas, coor);\r\n    if (!rect) {\r\n      return;\r\n    }\r\n    canvas.add(rect);\r\n    canvas.renderAll();\r\n    this.setState({ canvas }, this.setOutput);\r\n  }\r\n\r\n  doubleClickEvent(options: any): void {\r\n    const { canvas } = this.state;\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n    if (typeof options === \"object\" && typeof options.target === \"object\" && options.target) {\r\n      const left = options.target.left;\r\n      const top = options.target.top;\r\n      const width = options.target.width;\r\n      const height = options.target.height;\r\n      const attribute: IAttribute = {\r\n        left: left + 50,\r\n        top: top + 50,\r\n        width: width * options.target.scaleX,\r\n        height: height * options.target.scaleY,\r\n      };\r\n      const rect = this.createObjectByAttribute(attribute);\r\n      canvas.add(rect);\r\n      canvas.renderAll();\r\n      this.setState({ canvas }, this.setOutput);\r\n    } else if (typeof options === \"object\" && typeof options.pointer === \"object\" && options.pointer) {\r\n      const left = options.absolutePointer.x;\r\n      const top = options.absolutePointer.y;\r\n      const attribute: IAttribute = {\r\n        left: left,\r\n        top: top,\r\n        width: 100,\r\n        height: 100,\r\n      };\r\n      const rect = this.createObjectByAttribute(attribute);\r\n      canvas.add(rect);\r\n      canvas.renderAll();\r\n      this.setState({ canvas }, this.setOutput);\r\n    }\r\n  }\r\n\r\n  createObjectByAttribute(attribute: IAttribute): CustomFabricRect {\r\n    return new CustomFabricRect({\r\n      left: attribute.left,\r\n      top: attribute.top,\r\n      width: attribute.width,\r\n      height: attribute.height,\r\n      fill: this.color,\r\n      opacity: this.opacity,\r\n      id: null,\r\n      strokeDashArray: this.strokeDashArray,\r\n      stroke: this.strokeColor,\r\n      strokeWidth: this.strokeWidth,\r\n      lockRotation: true,\r\n    });\r\n  }\r\n\r\n  shapetoStructureData(element: CustomFabricRect): IOutputData | null {\r\n    const { canvas } = this.state;\r\n    if (!canvas) {\r\n      return null;\r\n    }\r\n    if (\r\n      !element.left ||\r\n      !element.top ||\r\n      !element.width ||\r\n      !element.height ||\r\n      !element.scaleX ||\r\n      !element.scaleY ||\r\n      !canvas.width ||\r\n      !canvas.height\r\n    ) {\r\n      return null;\r\n    }\r\n    const { includeDataUrl, includeHtmlCanvas } = this.props;\r\n    const x1 = element.left / canvas.width;\r\n    const y1 = element.top / canvas.height;\r\n    const x2 = (element.left + element.width * element.scaleX) / canvas.width;\r\n    const y2 = (element.top + element.height * element.scaleY) / canvas.height;\r\n    const rectangle = { x1: x1, y1: y1, x2: x2, y2: y2 };\r\n    const coord: IOutputData = {\r\n      id: element.id,\r\n      rect: JSON.stringify(rectangle),\r\n    };\r\n    if (typeof canvas === \"object\" && typeof canvas.backgroundImage === \"object\" && canvas.backgroundImage) {\r\n      const canvasBackground = canvas.backgroundImage;\r\n      if (includeDataUrl) {\r\n        let dataUrl: string | null = null;\r\n        try {\r\n          dataUrl = canvasBackground.toDataURL({\r\n            height: element.getScaledHeight(),\r\n            width: element.getScaledWidth(),\r\n            left: element.left,\r\n            top: element.top,\r\n            format: \"jpeg\",\r\n          });\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n        coord.dataUrl = dataUrl;\r\n      }\r\n      if (includeHtmlCanvas) {\r\n        let canvasElement = null;\r\n        try {\r\n          canvasElement = canvasBackground.toCanvasElement({\r\n            height: element.getScaledHeight(),\r\n            width: element.getScaledWidth(),\r\n            left: element.left,\r\n            top: element.top,\r\n          });\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n        coord.canvasElement = canvasElement;\r\n      }\r\n      if (canvasBackground.width && canvasBackground.height) {\r\n        const imgWidth = canvasBackground.width;\r\n        const imgHeight = canvasBackground.height;\r\n        const x1Px = x1 * imgWidth;\r\n        const x2Px = x2 * imgWidth;\r\n        const y1Px = y1 * imgHeight;\r\n        const y2Px = y2 * imgHeight;\r\n        const rectanglePx = {\r\n          x: x1Px,\r\n          y: y1Px,\r\n          x2: x2Px,\r\n          y2: y2Px,\r\n          w: x2Px - x1Px,\r\n          h: y2Px - y1Px,\r\n          boundX: imgWidth,\r\n          boundY: imgHeight,\r\n        };\r\n        coord.crop = JSON.stringify(rectanglePx);\r\n      }\r\n    }\r\n    coord.deletedAt = \"-1\";\r\n    return coord;\r\n  }\r\n\r\n  deleteShapes(): void {\r\n    const { canvas } = this.state;\r\n    if (canvas) {\r\n      canvas.getActiveObjects().forEach(function (element) {\r\n        canvas.remove(element);\r\n      });\r\n      this.setState({ canvas }, this.setOutput);\r\n    }\r\n  }\r\n\r\n  setOutput(): void {\r\n    const { canvas } = this.state;\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n    const shapeToStructureData = this.shapetoStructureData.bind(this);\r\n    const outputValue: Array<IOutputData> = [];\r\n    const cropcoords = canvas.getObjects(\"rect\");\r\n    cropcoords.forEach(function (element: Object) {\r\n      const data = element as CustomFabricRect;\r\n      const outputData = shapeToStructureData(data);\r\n      if (outputData) {\r\n        outputValue.push(outputData);\r\n      }\r\n    });\r\n    // let stringOut = JSON.stringify(outputValue)\r\n    const { input } = this.props;\r\n    if (input) {\r\n      input.onChange(outputValue);\r\n    }\r\n  }\r\n\r\n  createObject(canvas: fabric.Canvas | null, coor: ICoord): CustomFabricRect | null {\r\n    if (!canvas) {\r\n      return null;\r\n    }\r\n    if (!canvas.width || !canvas.height)\r\n    {\r\n      return null;\r\n    }\r\n    let rectangle: any;\r\n    if (typeof coor.rect === \"string\") {\r\n      rectangle = JSON.parse(coor.rect);\r\n    } else {\r\n      rectangle = coor.rect;\r\n    }\r\n    const left = canvas.width * rectangle.x1;\r\n    const top = canvas.height * rectangle.y1;\r\n    const right = canvas.width * rectangle.x2;\r\n    const bottom = canvas.height * rectangle.y2;\r\n    const width = right - left;\r\n    const height = bottom - top;\r\n    return new CustomFabricRect({\r\n      left: left,\r\n      top: top,\r\n      width: width,\r\n      height: height,\r\n      fill: this.color,\r\n      opacity: this.opacity,\r\n      id: coor.id,\r\n      strokeDashArray: this.strokeDashArray,\r\n      stroke: this.strokeColor,\r\n      strokeWidth: this.strokeWidth,\r\n      lockRotation: true,\r\n    });\r\n  }\r\n\r\n  multiSelect(): void {\r\n    const { canvas } = this.state;\r\n    if (canvas) {\r\n      canvas.discardActiveObject();\r\n      const sel = new fabric.ActiveSelection(canvas.getObjects(), {\r\n        canvas: canvas,\r\n      });\r\n      canvas.setActiveObject(sel);\r\n      canvas.requestRenderAll();\r\n    } else {\r\n      console.log(\"Canvas not defined\");\r\n    }\r\n  }\r\n\r\n  discardActiveObject(): void {\r\n    const { canvas } = this.state;\r\n    if (canvas) {\r\n      canvas.discardActiveObject();\r\n      canvas.requestRenderAll();\r\n    } else {\r\n      console.log(\"Canvas not defined\");\r\n    }\r\n  }\r\n\r\n  keyboardHandler(event: React.KeyboardEvent<HTMLDivElement>): void {\r\n    if (event.defaultPrevented) {\r\n      return;\r\n    }\r\n    let handled = false;\r\n    const key = event.key || event.keyCode;\r\n    if (key === \"Delete\" || key === 46) {\r\n      // Handle Delete\r\n      this.deleteShapes();\r\n      handled = true;\r\n    } else if (event.ctrlKey && (key === 65 || key === \"a\")) {\r\n      this.multiSelect();\r\n      handled = true;\r\n    }\r\n    if (handled) {\r\n      // Suppress \"double action\" if event handled\r\n      event.preventDefault();\r\n    }\r\n  }\r\n\r\n  render(): JSX.Element {\r\n    const { input, source, showLabel, showButton, id, width, height } = this.props;\r\n    const renderInputRedux = !!input;\r\n    let valueForm: any;\r\n    let nameForm = source;\r\n    if (input) {\r\n      const { value, name } = input;\r\n      valueForm = value;\r\n      nameForm = name;\r\n    }\r\n\r\n    return (\r\n      <div id=\"canvas-wrapper\">\r\n        {showLabel && <div className=\"label\">{nameForm}</div>}\r\n\r\n        <Grid container direction=\"row\" justify=\"flex-start\" alignItems=\"flex-start\">\r\n          <Grid item xs onKeyDown={this.keyboardHandler} tabIndex={0}>\r\n            <canvas id={id} width={width} height={height} style={{ border: \"0px solid #aaa\" }} />\r\n          </Grid>\r\n          {showButton && (\r\n            <Grid container item xs direction=\"column\" justify=\"flex-start\" alignItems=\"flex-start\">\r\n              <Grid item xs>\r\n                <Button variant=\"contained\" id=\"addmore\" color=\"primary\" onClick={this.addNew}>\r\n                  {\" \"}\r\n                  Add More Shapes\r\n                </Button>\r\n              </Grid>\r\n              <Grid item xs>\r\n                <Button variant=\"contained\" id=\"deleteselected\" color=\"primary\" onClick={this.deleteShapes}>\r\n                  {\" \"}\r\n                  Delete Selected Object{\" \"}\r\n                </Button>\r\n              </Grid>\r\n              <Grid item xs>\r\n                <Button variant=\"contained\" id=\"multiselect\" color=\"primary\" onClick={this.multiSelect}>\r\n                  {\" \"}\r\n                  Select All{\" \"}\r\n                </Button>\r\n              </Grid>\r\n              <Grid item xs>\r\n                <Button variant=\"contained\" id=\"discard\" color=\"primary\" onClick={this.discardActiveObject}>\r\n                  {\" \"}\r\n                  Discard Selection\r\n                </Button>\r\n              </Grid>\r\n            </Grid>\r\n          )}\r\n          {renderInputRedux && <input type=\"hidden\" value={valueForm} />}\r\n        </Grid>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ReactMultiCrop;\r\n"],"names":["__extends","options","_super","_this","id","fabric","Rect","props","state","canvas","initial","color","cropBackgroundColor","opacity","cropBackgroundOpacity","strokeColor","cropOutlineColor","strokeWidth","cropOutlineWidth","strokeDashArray","keyboardHandler","bind","addNew","deleteShapes","multiSelect","discardActiveObject","ReactMultiCrop","initialCanvas","backgroundImage","initialImage","img","_a","width","height","setBackgroundImage","renderAll","scaleX","scaleY","setState","initialObjects","url","parts","match","REGEXP_ORIGINS","location","protocol","hostname","port","record","image","loadImageNow","loadImage","isCrossOrigin","isCrossOriginURL","crossOrigin","Image","fromURL","setOutput","setStateOf","inputObject","clippings","createObject_1","createObject","Array","isArray","length","forEach","coord","rect","add","console","log","delta","e","deltaY","zoom","getZoom","Math","setZoom","preventDefault","stopPropagation","Canvas","uniScaleTransform","doubleClickEvent","objectModifiedEvent","zoomHandler","on","opt","evt","altKey","isDragging","selection","lastPosX","clientX","lastPosY","clientY","vpt","viewportTransform","requestRenderAll","setViewportTransform","initialImg","coor","x1","y1","x2","y2","target","left","top_1","top","attribute","createObjectByAttribute","pointer","absolutePointer","x","top_2","y","CustomFabricRect","fill","stroke","lockRotation","element","includeDataUrl","includeHtmlCanvas","rectangle","JSON","stringify","canvasBackground","dataUrl","toDataURL","getScaledHeight","getScaledWidth","format","error","canvasElement","toCanvasElement","imgWidth","imgHeight","x1Px","x2Px","y1Px","y2Px","rectanglePx","w","h","boundX","boundY","crop","deletedAt","getActiveObjects","remove","shapeToStructureData","shapetoStructureData","outputValue","cropcoords","getObjects","data","outputData","push","input","onChange","parse","right","bottom","sel","ActiveSelection","setActiveObject","event","defaultPrevented","handled","key","keyCode","ctrlKey","source","showLabel","showButton","renderInputRedux","valueForm","nameForm","value","name_1","React","className","Grid","container","direction","justify","alignItems","item","xs","onKeyDown","tabIndex","style","border","Button","variant","onClick","type","Component"],"mappings":"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"}